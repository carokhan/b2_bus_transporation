# Using Google OAuth2 with Flutter on Android
### Introduction
OAuth2 (Open Authentication) has evolved to be one of the most ubiquitous methods of authentication. This owes to its simplicity of use and implementation.

### Code
To do so in Flutter, the [google_sign_in](https://pub.dev/packages/google_sign_in) library can be used.

To do so, we must add the package to `pubspec.yaml` like so:
```
    dependencies:
      flutter:
        sdk: flutter
     ...
      google_sign_in: ^6.0.2
```
Additionally, this must be added to `/android/build.gradle`.
```
    dependencies {
        ...
        classpath 'com.google.gms:google-services:4.3.15'
        ...
    }
}
```
This will ensure the correct version of the package is installed for use.

Next, in our `main.dart` file or wherever else we would like to call the sign-in, we must import the package:
`import 'package:google_sign_in/google_sign_in.dart';`
and then actually use it as follows:
```dart
  void _login() async {
    if (_loginIcon == Icons.login) {
      final GoogleSignIn _googleSignIn = GoogleSignIn();
      bool _isLoggedIn = false;
      //late GoogleSignInAccount _userObj;
      try {
        await _googleSignIn.signIn().then((userData) {
          //Login Success
          print(userData.toString());
          setState(() {
            //change login button symbol
            _loginTooltip = "Logout";
            _loginIcon = Icons.logout;
          });
        }).catchError((e) {
          print(e.toString());
        });
      } catch (e) {
        print(e.toString());
      }
    }
  }
```

This defines a function that can be called when a button or other trigger is pressed. It uses the `GoogleSignIn` provided by the library, which removes much of the overhead involved with implementing tbe feature. A boolean `_isLoggedIn` is then defined in case it must be used later.

Starting at `try`, it attempts to retrieve the sign-in's results, printing them to the console. It then changes the login tooltip to "Logout" as well as the icon. However, if this is unsuccessful for whatever reason, the `catch` block is triggered and the error is printed to the console.

### Authentication
A few steps must be taken to properly authenticate the service outside the code as well.

Namely, the app must be registered through (Google Firebase)[https://firebase.google.com/]). The app does not actually store any data there; this is purely to register the app with Google. Once a Firebase account is made, go to (the Firebase console)[https://console.firebase.google.com/] and click "Add project". Once the project is created, click thw Android logo on the homepage to register it. 

This process will ask for a few questions about the app, including the package name and nickname. However, there is one more field - the debug signing certificate SHA1.

Google OAuth2 needs a signed certificate in order to generate an OAuth2 client, which in turn requires the SHA-1 of the signing certificate. Until the app is pushed into production, this signing certificate must be generated in debug mode, specifically in the form of a `debug.keystore` file.

This can be generated by running the following command in the terminal:

`$ keytool -genkey -v -keystore debug.keystore -storepass android -alias androiddebugkey -keypass android -keyalg RSA -keysize 2048 -validity 10000`

This will ask a few questions and then generate the file with the username `android` and the password `android`. Once the file is generated, ensure it is stored at `~/.android`.

Next, we must generate the SHA-1. The easiest way to do so is to install and navigate to `/android` directory in the Terminal and run `./gradleW signingReport`. This should generate output like the following (of course, without blank fields):

```
$ ./gradlew signingReport 

> Task :app:signingReport
Variant: debug
Config: debug
Store: /home/ronin/.android/debug.keystore
Alias: AndroidDebugKey
MD5: 
SHA1: 
SHA-256: 
Valid until: Tuesday, April 1, 2053
----------
Variant: release
Config: debug
Store: /home/ronin/.android/debug.keystore
Alias: AndroidDebugKey
MD5: 
SHA1: 
SHA-256: 
Valid until: Tuesday, April 1, 2053
----------
Variant: profile
Config: debug
Store: /home/ronin/.android/debug.keystore
Alias: AndroidDebugKey
MD5: 
SHA1: 
SHA-256: 
Valid until: Tuesday, April 1, 2053
----------
Variant: debugAndroidTest
Config: debug
Store: /home/ronin/.android/debug.keystore
Alias: AndroidDebugKey
MD5: 
SHA1: 
SHA-256: 
Valid until: Tuesday, April 1, 2053
----------

> Task :google_sign_in_android:signingReport
Variant: debugAndroidTest
Config: debug
Store: /home/ronin/.android/debug.keystore
Alias: AndroidDebugKey
MD5: 
SHA1: 
SHA-256: 
Valid until: Tuesday, April 1, 2053
----------
```
Provide the SHA-1 to the Firebase wizard, and then submit it. It will then provide you with the `google-services.json` file, which must be placed in `/android/app`.

Finally, go to the Firebase project settings and ensure a support email is provided. This is necessary in order to prevent login errors.

Setup complete! ðŸŽ‰
